<html>
  <head>
    <title>Open iRail Map</title>
    <link rel="stylesheet" href="assets/css/leaflet.css" media="screen" title="no title" charset="utf-8">
    <script src="assets/js/leaflet.js" charset="utf-8"></script>
    <script src="https://code.jquery.com/jquery-3.0.0.min.js" integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0=" crossorigin="anonymous"></script>
  </head>

  <body>
    <div id="map" style="width: 100%; height: 100%"></div>

    <script>

    var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
      '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw';

    var grayscale   = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr}),
      streets  = L.tileLayer(mbUrl, {id: 'mapbox.streets',   attribution: mbAttr});

    var map = L.map('map', {
    center: [50.8503, 4.3517],
    zoom: 8,
    layers: [grayscale]
    });


    var query_log = 'http://api.irail.be/logs';

    $.getJSON(
      {
        url: query_log,
        success: function(data)
        {
          for(var log in data )
          {
            var query = data[log];
            if(query != null && query.querytype !== null && query.querytype == 'connections' && query.code == null)
            {
                var latFrom = query.query.departureStop.latitude;
                var longFrom =  query.query.departureStop.longitude;
                var latTo =  query.query.arrivalStop.latitude;
                var longTo =  query.query.arrivalStop.longitude;
                var pointFrom = new L.LatLng(latFrom, longFrom);
                var pointTo = new L.LatLng(latTo, longTo);

                var pointList = [pointFrom, pointTo];

                var polyline = new L.Polyline(pointList,
                {
                  color: 'red',
                  weight: 3,
                  opacity: 0.5,
                  smoothFactor: 3
                });




                var fromMarker = new L.marker([latFrom, longFrom]).bindPopup(query.query.departureStop.name);
                fromMarker.addTo(map);
                var toMarker = new L.marker([latTo,longTo]).bindPopup(query.query.arrivalStop.name);
                toMarker.addTo(map);

                polyline.addTo(map);

            		/*var baseLayers = {
            			"Grayscale": grayscale,
            			"Streets": streets
            		};

            		var overlays = {
            			"Cities": cities
            		};

            		L.control.layers(baseLayers, overlays).addTo(map);*/




            }
          }
        }
      }
    );





	</script>

  </body>
</html>
